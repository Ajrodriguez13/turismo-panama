<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Registrar Sitio Turístico</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header>
    <nav>
      <ul>
        <li><a href="index.html">Inicio</a></li>
        <li><a href="mapa.html">Ver Mapa</a></li>
        <li><a href="registro.html">Registrar Sitio</a></li>
      </ul>
    </nav>
  </header>

  <main>
    <h2>Registrar un nuevo sitio turístico</h2>
    <form id="sitioForm">
      <label>Nombre del sitio:<br><input type="text" name="nombre" required></label><br>
      <label>Descripción:<br><textarea name="descripcion" required></textarea></label><br>
      <label>Latitud:<br><input type="number" step="any" name="latitud" required></label><br>
      <label>Longitud:<br><input type="number" step="any" name="longitud" required></label><br>
      <label>Imagen:<br><input type="file" name="imagen" accept="image/*" required></label><br>
      <button type="submit">Registrar</button>
    </form>
    <div id="mensaje"></div>
  </main>

  <script>
    document.getElementById('sitioForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const mensaje = document.getElementById('mensaje');
      mensaje.textContent = 'Enviando...';

      const form = e.target;
      const imagenFile = form.imagen.files[0];
      const reader = new FileReader();

      reader.onloadend = async () => {
        const imagenBase64 = reader.result.split(',')[1]; // quitar encabezado 'data:image/...;base64,'

        const datos = {
          nombre: form.nombre.value,
          descripcion: form.descripcion.value,
          latitud: form.latitud.value,
          longitud: form.longitud.value,
          imagenBase64: imagenBase64
        };

        try {
          const res = await fetch('https://9obu4mao37.execute-api.us-east-1.amazonaws.com/dev/sitios', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(datos)
          });

          const json = await res.json();

          if (res.ok) {
            mensaje.textContent = '✅ ' + json.mensaje;
            form.reset();
          } else {
            mensaje.textContent = '❌ Error: ' + (json.error || 'No se pudo registrar el sitio');
          }

        } catch (err) {
          console.error(err);
          mensaje.textContent = '❌ Error al conectar con la API.';
        }
      };

      reader.readAsDataURL(imagenFile);
    });
  </script>

</body>
</html>